name: SRA Mutation Analysis

on:
  workflow_dispatch:

jobs:
  analyze-mutations:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v3

      - name: ðŸ”§ Install dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y sra-toolkit fastqc bwa samtools bcftools

      - name: ðŸ“¥ Download SRA and convert to FASTQ
        run: |
          prefetch SRR27104041
          fasterq-dump SRR27104041
          mv SRR27104041.fastq reads.fastq

      - name: ðŸ”¬ Index reference genome
        run: bwa index NC_045512.2.fasta

      - name: ðŸ§¬ Align reads to reference
        run: bwa mem NC_045512.2.fasta reads.fastq > aln.sam

      - name: ðŸ”„ Convert SAM to BAM, sort and index
        run: |
          samtools view -Sb aln.sam > aln.bam
          samtools sort aln.bam -o aln.sorted.bam
          samtools index aln.sorted.bam

      - name: ðŸ§ª Call variants with bcftools
        run: |
          bcftools mpileup -f NC_045512.2.fasta aln.sorted.bam | bcftools call -mv -Ov -o variants.vcf

      - name: ðŸ“¤ Verify file exists before upload
        run: ls -lh variants.vcf

      - name: ðŸ“¤ Upload mutation list
        uses: actions/upload-artifact@v3
        with:
          name: variants
          path: variants.vcf
